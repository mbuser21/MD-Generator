<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD GEN</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Bengali', 'Kalpurush', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .form-section, .preview-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1, h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
            background: white;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-upload-btn:hover {
            background: #5568d3;
        }

        .file-name {
            margin-left: 10px;
            color: #666;
            font-size: 13px;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 30px;
        }

        button {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-download {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(56, 239, 125, 0.4);
        }

        #bannerCanvas {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-section">
            <h1>üè• ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</h1>
            
            <div class="form-group">
                <label>‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:</label>
                <input type="text" id="doctorName" placeholder="‡¶°‡¶æ‡¶É ‡¶∏‡ßÅ‡¶¶‡¶ø‡¶™ ‡¶ö‡¶®‡ßç‡¶¶‡ßç‡¶∞ ‡¶¶‡¶æ‡¶∏">
            </div>

            <div class="form-group">
                <label>‡¶∞‡¶ô‡ßá‡¶∞ ‡¶•‡¶ø‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</label>
                <select id="colorScheme" onchange="generateBanner()">
                    <option value="green">‡¶∏‡¶¨‡ßÅ‡¶ú ‡¶•‡¶ø‡¶Æ (‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü)</option>
                    <option value="blue">‡¶®‡ßÄ‡¶≤ ‡¶•‡¶ø‡¶Æ</option>
                    <option value="purple">‡¶¨‡ßá‡¶ó‡ßÅ‡¶®‡¶ø ‡¶•‡¶ø‡¶Æ</option>
                    <option value="teal">‡¶ü‡¶ø‡¶≤ ‡¶•‡¶ø‡¶Æ</option>
                </select>
            </div>

            <div class="form-group">
                <label>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑‡¶§‡ßç‡¶¨ (‡¶è‡¶ï‡¶ï ‡¶≤‡¶æ‡¶á‡¶®):</label>
                <input type="text" id="specialty" placeholder="‡¶Æ‡ßá‡¶°‡¶ø‡¶∏‡¶ø‡¶® ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑‡¶ú‡ßç‡¶û">
            </div>

            <div class="form-group">
                <label>‡¶°‡¶ø‡¶ó‡ßç‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶ß‡¶ø‡¶≠‡ßÅ‡¶ï‡ßç‡¶§‡¶ø (‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø Enter ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®):</label>
                <textarea id="degrees" placeholder="‡¶è‡¶Æ‡¶¨‡¶ø‡¶¨‡¶ø‡¶è‡¶∏, ‡¶¨‡¶ø‡¶™‡¶ø‡¶è‡¶≤ (‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø) ‡¶è‡¶Æ‡¶°‡¶ø (‡¶Æ‡ßá‡¶°‡¶ø‡¶∏‡¶ø‡¶®), ‡¶¨‡¶ø‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶Æ‡¶á‡¶â ‡¶è‡¶Æ‡¶è‡¶∏‡¶ø‡¶™‡¶ø (‡¶Ü‡¶Æ‡ßá‡¶∞‡¶ø‡¶ï‡¶æ)">‡¶è‡¶Æ‡¶¨‡¶ø‡¶¨‡¶ø‡¶è‡¶∏, ‡¶¨‡¶ø‡¶™‡¶ø‡¶è‡¶≤ (‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø) ‡¶è‡¶Æ‡¶°‡¶ø (‡¶Æ‡ßá‡¶°‡¶ø‡¶∏‡¶ø‡¶®), ‡¶¨‡¶ø‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶Æ‡¶á‡¶â ‡¶è‡¶Æ‡¶è‡¶∏‡¶ø‡¶™‡¶ø (‡¶Ü‡¶Æ‡ßá‡¶∞‡¶ø‡¶ï‡¶æ)</textarea>
            </div>

            <div class="form-group">
                <label>‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø (‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶≤‡¶æ‡¶á‡¶®‡ßá: ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ, ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ, ‡¶ö‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º):</label>
                <textarea id="clinicInfo" placeholder="‡¶∂‡¶§‡¶æ‡¶¨‡ßç‡¶¶‡ßÄ ‡¶Æ‡ßá‡¶°‡¶ø‡¶ï‡ßá‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏&#10;‡ß©‡ß©, ‡¶∞‡ßÇ‡¶™‡¶∏, ‡¶®‡¶ø‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶π‡¶≤‡ßç‡¶≤‡¶æ , ‡¶∏‡¶ø‡¶≤‡ßá‡¶ü&#10;‡¶ö‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º: ‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ (‡¶ú‡ßÅ‡¶Æ‡ßç‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶¶)">‡¶∂‡¶§‡¶æ‡¶¨‡ßç‡¶¶‡ßÄ ‡¶Æ‡ßá‡¶°‡¶ø‡¶ï‡ßá‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏
‡ß©‡ß©, ‡¶∞‡ßÇ‡¶™‡¶∏, ‡¶®‡¶ø‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶π‡¶≤‡ßç‡¶≤‡¶æ , ‡¶∏‡¶ø‡¶≤‡ßá‡¶ü
‡¶ö‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º: ‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ (‡¶ú‡ßÅ‡¶Æ‡ßç‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶¶)</textarea>
            </div>

            <div class="form-group">
                <label>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø):</label>
                <input type="text" id="contact" placeholder="01732-328633" value="01732-328633">
            </div>

            <div class="form-group">
                <label>‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø (‡¶Ü‡¶™‡¶≤‡ßã‡¶°):</label>
                <label class="file-upload-btn" for="doctorImage">‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <input type="file" id="doctorImage" accept="image/*">
                <span class="file-name" id="fileName"></span>
            </div>

            <div class="form-group">
                <label>‡¶≤‡ßã‡¶ó‡ßã ‡¶ì‡¶Ø‡¶º‡¶æ‡¶ü‡¶æ‡¶∞‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï):</label>
                <label class="file-upload-btn" for="logoImage">‡¶≤‡ßã‡¶ó‡ßã ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <input type="file" id="logoImage" accept="image/*">
                <span class="file-name" id="logoFileName"></span>
            </div>

            <div class="btn-group">
                <button class="btn-generate" onclick="generateBanner()">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="btn-download" onclick="downloadBanner()">WebP ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <div class="preview-section">
            <h2>üìã ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</h2>
            <div class="canvas-container">
                <canvas id="bannerCanvas"></canvas>
            </div>
        </div>
    </div>

    <script>
        let doctorImageData = null;
        let logoImageData = null;
        let fontLoaded = false;

        // Load Noto Sans Bengali font for canvas (more reliable than Kalpurush)
        const bengaliFont = new FontFace('Noto Sans Bengali', 'url(https://fonts.gstatic.com/s/notosansbengali/v20/Cn-SJsCGWQxOjaGwMQ6fIiMywrNJIky6nvd8BjzVMvJx2mcSPVFpVEqE-6KmsolKudCk8izI0lc.woff2)');
        
        bengaliFont.load().then(function(loadedFont) {
            document.fonts.add(loadedFont);
            fontLoaded = true;
            console.log('Bengali font loaded successfully');
            generateBanner();
        }).catch(function(error) {
            console.log('Font loading failed, using system fonts');
            fontLoaded = true;
            generateBanner();
        });

        document.getElementById('doctorImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = file.name;
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        doctorImageData = img;
                        generateBanner();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('logoImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('logoFileName').textContent = file.name;
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        logoImageData = img;
                        generateBanner();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        function generateBanner() {
            if (!fontLoaded) return; // Wait for font to load
            
            const canvas = document.getElementById('bannerCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size to higher resolution (1200x780 maintains aspect ratio)
            canvas.width = 1200;
            canvas.height = 780;

            // Get selected color scheme
            const colorScheme = document.getElementById('colorScheme').value;
            const colors = getColorScheme(colorScheme);

            // White background for main area
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, 960, 780);

            // Right section gradient with selected color
            const greenGradient = ctx.createLinearGradient(960, 0, 1200, 780);
            greenGradient.addColorStop(0, colors.gradientStart);
            greenGradient.addColorStop(1, colors.gradientEnd);
            ctx.fillStyle = greenGradient;
            ctx.fillRect(960, 0, 240, 600);

            // Add decorative medical graphics on green section
            ctx.save();
            
            // Medical cross patterns
            ctx.globalAlpha = 0.12;
            ctx.fillStyle = 'white';
            ctx.font = 'bold 68px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('‚úö', 1080, 360);
            ctx.fillText('‚úö', 1020, 480);
            ctx.fillText('‚úö', 1140, 465);
            
            // Heartbeat line pattern
            ctx.globalAlpha = 0.15;
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(975, 405);
            ctx.lineTo(1005, 405);
            ctx.lineTo(1020, 375);
            ctx.lineTo(1035, 435);
            ctx.lineTo(1050, 405);
            ctx.lineTo(1185, 405);
            ctx.stroke();
            
            // Medical pills/capsules
            ctx.globalAlpha = 0.1;
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(998, 285, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillRect(998, 273, 30, 24);
            ctx.beginPath();
            ctx.arc(1028, 285, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // Stethoscope shape
            ctx.globalAlpha = 0.08;
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.arc(1125, 300, 22, 0, Math.PI);
            ctx.lineTo(1125, 360);
            ctx.stroke();
            
            ctx.restore();

            // Calculate doctor image position for reference
            const imgSize = 210;
            const imgX = canvas.width - 150 - imgSize/2;
            const imgCenterY = 75 + imgSize/2; // Center Y of the doctor photo

            // Red header text - positioned above the green line
            ctx.fillStyle = '#d32f2f';
            ctx.font = 'bold 34px "Noto Sans Bengali", Arial, sans-serif';
            ctx.textAlign = 'left';
            const specialty = document.getElementById('specialty').value || '‡¶Æ‡ßá‡¶°‡¶ø‡¶∏‡¶ø‡¶® ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑‡¶ú‡ßç‡¶û';
            ctx.fillText(specialty, 52, imgCenterY - 25);

            // Green line horizontally aligned with doctor photo center
            ctx.fillStyle = colors.accentLine;
            ctx.fillRect(52, imgCenterY, imgX - 52 - 30, 4);

            // Doctor's name - positioned below the green line
            const doctorName = document.getElementById('doctorName').value || '‡¶°‡¶æ‡¶É ‡¶∏‡ßÅ‡¶¶‡¶ø‡¶™ ‡¶ö‡¶®‡ßç‡¶¶‡ßç‡¶∞ ‡¶¶‡¶æ‡¶∏';
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 58px "Noto Sans Bengali", Arial, sans-serif';
            ctx.fillText(doctorName, 52, imgCenterY + 70);

            // Degrees - positioned below doctor's name
            const degrees = document.getElementById('degrees').value || '‡¶è‡¶Æ‡¶¨‡¶ø‡¶¨‡¶ø‡¶è‡¶∏, ‡¶¨‡¶ø‡¶™‡¶ø‡¶è‡¶≤ (‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø) ‡¶è‡¶Æ‡¶°‡¶ø (‡¶Æ‡ßá‡¶°‡¶ø‡¶∏‡¶ø‡¶®), ‡¶¨‡¶ø‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶Æ‡¶á‡¶â ‡¶è‡¶Æ‡¶è‡¶∏‡¶ø‡¶™‡¶ø (‡¶Ü‡¶Æ‡ßá‡¶∞‡¶ø‡¶ï‡¶æ)';
            ctx.fillStyle = '#333';
            ctx.font = '23px "Noto Sans Bengali", Arial, sans-serif';
            const degreeLines = degrees.split('\n').filter(line => line.trim());
            let degreeY = imgCenterY + 115;
            degreeLines.forEach(line => {
                ctx.fillText(line, 52, degreeY);
                degreeY += 36;
            });

            // Dark green bottom section
            ctx.fillStyle = colors.bottomBar;
            ctx.fillRect(0, 600, 1200, 180);

            // Clinic info in bottom section
            ctx.fillStyle = 'white';
            ctx.font = 'bold 25px "Noto Sans Bengali", Arial, sans-serif';
            
            const clinicInfo = document.getElementById('clinicInfo').value || '‡¶∂‡¶§‡¶æ‡¶¨‡ßç‡¶¶‡ßÄ ‡¶Æ‡ßá‡¶°‡¶ø‡¶ï‡ßá‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏\n‡ß©‡ß©, ‡¶∞‡ßÇ‡¶™‡¶∏, ‡¶®‡¶ø‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶π‡¶≤‡ßç‡¶≤‡¶æ , ‡¶∏‡¶ø‡¶≤‡ßá‡¶ü\n‡¶ö‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º: ‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ (‡¶ú‡ßÅ‡¶Æ‡ßç‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶¶)';
            const clinicLines = clinicInfo.split('\n').filter(line => line.trim());
            
            let clinicY = 645;
            clinicLines.forEach((line, index) => {
                if (index === 0) {
                    ctx.font = 'bold 25px "Noto Sans Bengali", Arial, sans-serif';
                    ctx.fillText(line, 75, clinicY);
                } else {
                    ctx.font = '22px "Noto Sans Bengali", Arial, sans-serif';
                    ctx.fillText(line, 75, clinicY);
                }
                clinicY += 38;
            });

            // Contact info (right side)
            ctx.font = '21px "Noto Sans Bengali", Arial, sans-serif';
            ctx.textAlign = 'right';
            ctx.fillText('‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø', 1125, 652);
            ctx.font = 'bold 34px "Noto Sans Bengali", Arial, sans-serif';
            const contact = document.getElementById('contact').value || '01732-328633';
            ctx.fillText(contact, 1125, 698);

            // Doctor's image (circular) - top right with margins
            if (doctorImageData) {
                ctx.save();
                const imgSize = 210;
                const imgX = canvas.width - 150 - imgSize/2; // 150px margin from right (scaled)
                const imgY = 75 + imgSize/2; // 75px margin from top (scaled)
                
                // White circle background
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(imgX, imgY, imgSize/2 + 12, 0, Math.PI * 2);
                ctx.fill();
                
                // Clip to circle for image
                ctx.beginPath();
                ctx.arc(imgX, imgY, imgSize/2, 0, Math.PI * 2);
                ctx.closePath();
                ctx.clip();
                
                ctx.drawImage(doctorImageData, imgX - imgSize/2, imgY - imgSize/2, imgSize, imgSize);
                ctx.restore();

                // Border around image with theme color
                ctx.strokeStyle = colors.imageBorder;
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.arc(imgX, imgY, imgSize/2 + 3, 0, Math.PI * 2);
                ctx.stroke();
            }

            // Logo watermark in bottom right of white section
            if (logoImageData) {
                ctx.save();
                const logoMaxWidth = 180;
                const logoMaxHeight = 180;
                const logoPadding = 40;
                
                // Calculate logo size maintaining aspect ratio
                let logoWidth = logoImageData.width;
                let logoHeight = logoImageData.height;
                const logoAspect = logoWidth / logoHeight;
                
                if (logoWidth > logoMaxWidth) {
                    logoWidth = logoMaxWidth;
                    logoHeight = logoWidth / logoAspect;
                }
                if (logoHeight > logoMaxHeight) {
                    logoHeight = logoMaxHeight;
                    logoWidth = logoHeight * logoAspect;
                }
                
                // Position in bottom right of white section
                const logoX = 960 - logoWidth - logoPadding;
                const logoY = 600 - logoHeight - logoPadding;
                
                // Reduced opacity watermark (40%)
                ctx.globalAlpha = 0.4;
                ctx.drawImage(logoImageData, logoX, logoY, logoWidth, logoHeight);
                ctx.restore();
            }
        }

        function getColorScheme(scheme) {
            const schemes = {
                green: {
                    gradientStart: '#7cb342',
                    gradientEnd: '#558b2f',
                    accentLine: '#7cb342',
                    bottomBar: '#3d5a3d',
                    imageBorder: '#7cb342'
                },
                blue: {
                    gradientStart: '#42a5f5',
                    gradientEnd: '#1976d2',
                    accentLine: '#42a5f5',
                    bottomBar: '#1565c0',
                    imageBorder: '#42a5f5'
                },
                purple: {
                    gradientStart: '#ab47bc',
                    gradientEnd: '#7b1fa2',
                    accentLine: '#ab47bc',
                    bottomBar: '#6a1b9a',
                    imageBorder: '#ab47bc'
                },
                teal: {
                    gradientStart: '#26a69a',
                    gradientEnd: '#00796b',
                    accentLine: '#26a69a',
                    bottomBar: '#00695c',
                    imageBorder: '#26a69a'
                }
            };
            return schemes[scheme] || schemes.green;
        }

        function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            let currentY = y;

            for (let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > maxWidth && n > 0) {
                    ctx.fillText(line, x, currentY);
                    line = words[n] + ' ';
                    currentY += lineHeight;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, x, currentY);
        }

        function downloadBanner() {
            const canvas = document.getElementById('bannerCanvas');
            
            if (canvas.width === 0 || canvas.height === 0) {
                alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }

            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                const doctorName = document.getElementById('doctorName').value || 'doctor_banner';
                
                // Use the exact name from input field (can be Bengali or English)
                let fileName = doctorName
                    .trim()
                    .replace(/\s+/g, '_'); // Replace spaces with underscore
                
                // If filename is empty, use default
                if (!fileName) {
                    fileName = 'doctor_banner';
                }
                
                link.href = url;
                link.download = `${fileName}.webp`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }, 'image/webp', 0.80);
        }

        // Generate initial banner on page load
        window.onload = function() {
            // Font loading is handled above, will auto-generate when ready
        };
    </script>
</body>
</html>
